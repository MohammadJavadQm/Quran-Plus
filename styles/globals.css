/* ==========================================================================
 * Final & Perfected Global Stylesheet (v2.1 - Enhanced Edition) - Corrected
 * - Full Day/Night theming with all original capabilities preserved
 * - ADDED: Animated gradient background from the Ultimate UI Kit.
 * - ADDED: Scroll-driven progress bar from the Ultimate UI Kit.
 * - [خفن‌تر شد] ADDED: Custom theme-aware scrollbars.
 * - [خفن‌تر شد] ADDED: Subtle interactive animations for cards, buttons, and links.
 * - [خفن‌تر شد] ADDED: Dynamic aurora effect to the background gradient.
 * - [خفن‌تر شد] ADDED: Universal smooth transitions for theme switching.
 * - [خفن‌تر شد] ADDED: Enhanced focus states and text selection styles.
 * ========================================================================== */

/* 1) Fonts (kept, de-duplicated) */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto:wght@400;500;700&family=Poppins:wght@300;400;500;600;700;800&family=Lateef:wght@400;500;600;700&family=Amiri:wght@400;700&display=swap');

/* 2) Tailwind Directives */
@tailwind base;
@tailwind components;
@tailwind utilities;

/*
 * [جدید] ثبت پراپرتی سفارشی برای انیمیشن بهینه نوار پیشرفت اسکرول
 */
@property --scroll-progress {
  syntax: '<percentage>';
  inherits: false;
  initial-value: 0%;
}

/* 3) Custom Base Styles */
@layer base {
  /* 3.1) Day (Light) Theme */
  :root {
    /* --- Light Theme ("Green & Gold") --- */
    /* Core Palette */
    --background: hsl(45, 33%, 93%);
    --foreground: hsl(111, 40%, 8%);
    --text-primary: hsl(148, 51%, 25%);
    --text-secondary: hsl(147, 8%, 31%);
    --accent-primary: hsl(45, 52%, 53%);   /* Gold */
    --accent-secondary: hsl(148, 47%, 33%); /* Mid Green */

    /* [جدید] متغیرهای پس‌زمینه گرادینت از کیت UI */
    --gradient-bg-1: oklch(97% 0.02 50);
    --gradient-bg-2: oklch(97% 0.03 90);
    --gradient-bg-3: oklch(97% 0.02 30);
    --gradient-accent: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    --z-scroll-progress: 9999; /* Z-index برای نوار پیشرفت */

    /* [خفن‌تر شد] متغیرهای افکت شفق قطبی (Aurora) */
    --aurora-1: hsla(148, 50%, 60%, 0.15);
    --aurora-2: hsla(45, 60%, 65%, 0.1);


    /* UI Elements */
    --card-bg: hsla(0, 0%, 100%, 0.75);
    --card-border: hsla(45, 52%, 53%, 0.5); /* gold border (day default) */
    --card-border-gold: hsla(45, 52%, 53%, 0.5);
    --card-border-purple: rgba(106, 46, 189, 0.7); /* keep original alt border */
    --input-bg: hsla(148, 51%, 25%, 0.03);
    --section-bg: hsla(0, 0%, 0%, 0.02);

    /* Interactive */
    --focus-ring-color: hsla(45, 52%, 53%, 0.8); /* [خفن‌تر شد] Opacity increased */
    --selection-bg: hsla(148, 47%, 33%, 0.25);
    --accent-primary-bg: hsla(45, 52%, 53%, 0.1);
    --accent-primary-border: hsla(45, 52%, 53%, 0.2);
    --glow-color: hsla(45, 100%, 70%, 0.8);

    /* Buttons */
    --btn-text-color: hsl(45, 33%, 95%);
    --btn-grad-start: var(--accent-secondary);
    --btn-grad-end: hsl(148, 47%, 40%);
    --btn-grad-mid: hsl(135, 45%, 34%);
    --btn-grad-start-hover: hsl(148, 47%, 28%);
    --btn-grad-end-hover: hsl(148, 47%, 35%);
    --btn-arrow-bg: hsla(0, 0%, 100%, 0.12);
    --btn-hover-shadow: hsla(148, 47%, 33%, 0.3);
    --btn-primary-shadow: hsla(148, 51%, 25%, 0.2);

    /* Extra Palettes kept from original */
    --bg-dark: #0c0b15;
    --bg-darker: #070610;
    --purple-dark: #3a1f5f;
    --purple-neon: #6a2ebd;
    --neon-blue: #00d0ff;
    --neon-green: #00ff9d;
    --gold-neon: #ffd700;
    --glass-bg: rgba(20, 15, 40, 0.45);
    --text-main: #f0f0ff;
    --text-subtle: #b0b0d0;

    /* Shadows & Effects */
    --shadow-color: hsla(148, 51%, 25%, 0.1);
    --soft-shadow: hsla(148, 51%, 25%, 0.1);
    --pattern-color: hsl(147, 8%, 70%);
    --pattern-opacity: 0.1;

    /* Component-Specific / Loading / Footer */
    --footer-bg: linear-gradient(135deg, hsl(150, 60%, 20%), hsl(145, 55%, 25%));
    --footer-text: hsl(45, 33%, 85%);
    --spinner-track-color: hsla(148, 47%, 33%, 0.2);
    --loading-bg: var(--background);
    --loading-text: var(--text-secondary);
    --loading-grad-start: hsl(45, 33%, 95%);
    --loading-grad-end: var(--background);
    --loading-ring-bg: hsla(147, 8%, 31%, 0.1);
    --loading-orb-shadow: hsla(45, 52%, 53%, 0.3);
    --loading-particle-opacity: 0.6;

    /* Premium variables kept */
    --bg: hsl(0, 0%, 7%);         /* kept for compatibility */
    --bg-2: hsl(0, 0%, 10%);
    --text-light: hsl(0, 0%, 94%);
    --text-muted: hsl(0, 0%, 63%);
    --accent-dark: hsl(148, 51%, 25%);
    --accent-mid: hsl(148, 47%, 33%);
    --accent-gold: hsl(45, 52%, 53%);

    /* Extra Shadows */
    --shadow-deep: hsla(0, 0%, 0%, 0.2);
    --shadow-glow-green: hsla(148, 47%, 33%, 0.15);
    --shadow-glow-gold: hsla(45, 52%, 53%, 0.2);

    /* Hero / Page colors */
    --hero-glow-1: rgba(176, 137, 104, 0.2);
    --hero-glow-2: rgba(127, 85, 57, 0.15);
    --page-background-color: #00B5D1; /* ☀️ day */
  }

  /* 3.2) Night (Dark) Theme */
  [data-theme='dark'] {
    /* --- Dark Theme ("Night Sky & Gold" + Emerald) --- */
    /* Core Palette */
    --background: hsl(220, 40%, 15%);
    --foreground: hsl(45, 33%, 93%);
    --text-primary: hsl(46, 31%, 89%);
    --text-secondary: hsl(220, 15%, 70%);
    --accent-primary: hsl(45, 52%, 53%);
    --accent-secondary: hsl(143, 45%, 45%);

    /* [جدید] متغیرهای پس‌زمینه گرادینت از کیت UI */
    --gradient-bg-1: oklch(10% 0.05 280);
    --gradient-bg-2: oklch(10% 0.06 310);
    --gradient-bg-3: oklch(10% 0.04 260);
    --gradient-accent: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));

    /* [خفن‌تر شد] متغیرهای افکت شفق قطبی (Aurora) */
    --aurora-1: hsla(143, 50%, 50%, 0.1);
    --aurora-2: hsla(220, 60%, 60%, 0.15);

    /* UI Elements */
    --card-bg: hsla(220, 40%, 18%, 0.75);
    --card-border: hsla(45, 52%, 53%, 0.3); /* gold border for dark */
    --card-border-gold: hsla(45, 52%, 53%, 0.3);
    --card-border-purple: rgba(106, 46, 189, 0.7);
    --input-bg: hsla(220, 30%, 20%, 0.5);
    --section-bg: hsla(220, 40%, 20%, 0.1);

    /* Interactive */
    --focus-ring-color: hsla(45, 52%, 53%, 0.8); /* [خفن‌تر شد] Opacity increased */
    --selection-bg: hsla(45, 52%, 53%, 0.25);
    --accent-primary-bg: hsla(45, 52%, 53%, 0.1);
    --accent-primary-border: hsla(45, 52%, 53%, 0.25);
    --glow-color: hsla(45, 100%, 70%, 0.7);

    /* Buttons */
    --btn-text-color: hsl(220, 30%, 95%);
    --btn-grad-start: hsl(215, 70%, 55%);
    --btn-grad-end: hsl(225, 75%, 60%);
    --btn-grad-mid: hsl(220, 70%, 60%);
    --btn-grad-start-hover: hsl(215, 70%, 65%);
    --btn-grad-end-hover: hsl(225, 75%, 70%);
    --btn-arrow-bg: hsla(220, 50%, 80%, 0.15);
    --btn-hover-shadow: hsla(220, 70%, 55%, 0.4);
    --btn-primary-shadow: hsla(220, 70%, 55%, 0.25);

    /* Extra Palettes kept */
    --bg-dark: #0c0b15;
    --bg-darker: #070610;
    --purple-dark: #3a1f5f;
    --purple-neon: #6a2ebd;
    --neon-blue: #00d0ff;
    --neon-green: #00ff9d;
    --gold-neon: #ffd700;
    --glass-bg: rgba(20, 15, 40, 0.45);
    --text-main: #f0f0ff;
    --text-subtle: #b0b0d0;

    /* Shadows & Effects */
    --shadow-color: hsla(220, 50%, 5%, 0.4);
    --soft-shadow: hsla(220, 50%, 5%, 0.2);
    --pattern-color: hsl(220, 15%, 60%);
    --pattern-opacity: 0.04;

    /* Component-Specific / Loading / Footer */
    --footer-bg: linear-gradient(135deg, hsl(160, 70%, 12%), hsl(175, 60%, 15%));
    --footer-text: hsl(220, 15%, 80%);
    --spinner-track-color: hsla(220, 40%, 30%, 0.5);
    --loading-bg: hsl(220, 40%, 12%);
    --loading-text: var(--text-primary);
    --loading-grad-start: hsl(220, 45%, 25%);
    --loading-grad-end: hsl(220, 40%, 12%);
    --loading-ring-bg: hsla(46, 31%, 89%, 0.1);
    --loading-orb-shadow: hsla(45, 52%, 53%, 0.4);
    --loading-particle-opacity: 0.3;

    /* Premium variables kept */
    --bg: hsl(0, 0%, 7%);
    --bg-2: hsl(0, 0%, 10%);
    --text-light: hsl(0, 0%, 94%);
    --text-muted: hsl(0, 0%, 63%);
    --accent-dark: hsl(148, 51%, 25%);
    --accent-mid: hsl(148, 47%, 33%);
    --accent-gold: hsl(45, 52%, 53%);

    /* Extra Shadows */
    --shadow-deep: hsla(0, 0%, 0%, 0.4);
    --shadow-glow-green: hsla(148, 47%, 33%, 0.15);
    --shadow-glow-gold: hsla(45, 52%, 53%, 0.2);

    /* Hero / Page colors */
    --hero-glow-1: rgba(106, 46, 189, 0.15);
    --hero-glow-2: rgba(0, 208, 255, 0.1);
    --page-background-color: #000F95; /* 🌙 night */
  }


  /* 3.3) Global Base Styles (Updated) */
  html {
    /* [خفن‌تر شد] رفتار اسکرول نرم برای لینک‌های داخلی */
    scroll-behavior: smooth;
  }

  body {
    /* [خفن‌تر شد] پس‌زمینه گرادینت متحرک + افکت شفق قطبی */
    background:
      radial-gradient(ellipse at 10% 10%, var(--aurora-1) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 90%, var(--aurora-2) 0%, transparent 50%),
      linear-gradient(-45deg, var(--gradient-bg-1), var(--gradient-bg-2), var(--gradient-bg-3));

    background-size: 400% 400%;

    /* [خفن‌تر شد] انیمیشن‌های لایه‌های مختلف پس‌زمینه */
    animation:
      gradient-flow 25s ease infinite,
      aurora-1 30s ease-in-out infinite alternate,
      aurora-2 40s ease-in-out infinite alternate;

    /* استایل‌های اصلی شما حفظ شده است */
    color: var(--text-primary);
    font-family: 'Inter', 'Roboto', 'Poppins', sans-serif;
    transition: background-color .4s ease, color .4s ease;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    min-height: 100vh;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  /* [خفن‌تر شد] انتقال نرم بین تم‌ها برای همه چیز */
  *, *::before, *::after {
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, fill 0.3s ease, stroke 0.3s ease, box-shadow 0.3s ease, opacity 0.3s ease;
  }

  /* [جدید] نوار پیشرفت مطالعه وابسته به اسکرول */
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: var(--scroll-progress); /* متصل به @property */
    height: 4px;
    background: var(--gradient-accent);
    z-index: var(--z-scroll-progress);
    animation: scroll-progress-animation linear;
    animation-timeline: scroll(root);
    /* [خفن‌تر شد] افکت درخشش برای نوار پیشرفت */
    box-shadow: 0 0 10px var(--accent-primary), 0 0 5px var(--accent-primary);
  }

  /* 3.4) Theme-Aware Background Pattern (Moved to ::after to allow for progress bar) */
  body::after { /* <<<< توجه: به ::after منتقل شد */
    content: '';
    position: fixed;
    inset: 0;
    z-index: -1;
    pointer-events: none;
    background-color: var(--pattern-color);
    mask-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'><g fill='black'><path d='M40 0 L80 40 L40 80 L0 40 Z'/><path d='M120 40 L160 80 L120 120 L80 80 Z'/><path d='M80 0 L120 40 L80 80 L40 40 Z'/><path d='M0 120 L40 160 L80 120 L40 80 Z'/><path d='M80 80 L120 120 L80 160 L40 120 Z'/></g></svg>");
    mask-repeat: repeat;
    -webkit-mask-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'><g fill='black'><path d='M40 0 L80 40 L40 80 L0 40 Z'/><path d='M120 40 L160 80 L120 120 L80 80 Z'/><path d='M80 0 L120 40 L80 80 L40 40 Z'/><path d='M0 120 L40 160 L80 120 L40 80 Z'/><path d='M80 80 L120 120 L80 160 L40 120 Z'/></g></svg>");
    -webkit-mask-repeat: repeat;
    opacity: var(--pattern-opacity);
    /* transition: opacity .3s ease, background-color .3s ease;  <-- Redundant due to universal transition */
  }

  /* 3.5) Typography & Links (kept & enhanced) */
  h1, h2, h3, h4, h5, h6 { color: var(--text-primary); }

  a {
    color: var(--accent-secondary);
    text-decoration: none;
    position: relative; /* [خفن‌تر شد] برای انیمیشن خط زیر */
    /* transition: color .2s ease; <-- Redundant */
  }
  a:hover { color: var(--accent-primary); }

  /* [خفن‌تر شد] انیمیشن خط زیر برای لینک‌ها */
  a::after {
    content: '';
    position: absolute;
    width: 100%;
    transform: scaleX(0);
    height: 2px;
    bottom: -4px;
    left: 0;
    background-color: var(--accent-primary);
    transform-origin: bottom right;
    transition: transform 0.25s ease-out;
  }
  a:hover::after {
    transform: scaleX(1);
    transform-origin: bottom left;
  }
  
  /* [خفن‌تر شد] استایل انتخاب متن (Text Selection) */
  ::selection {
    background-color: var(--selection-bg);
    color: var(--text-primary);
  }

  /* [خفن‌تر شد] استایل فوکوس برای دسترس‌پذیری بهتر */
  :is(a, button, input, textarea, select):focus-visible {
    outline: 2px solid var(--focus-ring-color);
    outline-offset: 2px;
    border-radius: 4px;
  }

  /* [جدید] انیمیشن‌های مورد نیاز برای پس‌زمینه و نوار پیشرفت */
  @keyframes gradient-flow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  @keyframes scroll-progress-animation {
    from { width: 0%; }
    to { width: 100%; }
  }

  /* [خفن‌تر شد] انیمیشن‌های افکت شفق قطبی */
  @keyframes aurora-1 {
    from { background-position: 10% 10%; }
    to { background-position: 60% 80%; }
  }
  @keyframes aurora-2 {
    from { background-position: 80% 90%; }
    to { background-position: 20% 20%; }
  }
}


/* [خفن‌تر شد] 4) لایه کامپوننت‌ها برای استایل‌های تعاملی */
@layer components {
  /* استایل پیش‌فرض برای کارت‌ها */
  .card {
    background-color: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 4px 15px var(--shadow-color);
    /* * این دو خط حذف شدند تا مشکل تاری برطرف شود
     * backdrop-filter: blur(10px);
     * -webkit-backdrop-filter: blur(10px);
    */
  }

  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px var(--shadow-deep);
    border-color: var(--accent-primary);
  }

  /* استایل پیش‌فرض برای دکمه‌ها */
  .btn {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    background-image: linear-gradient(135deg, var(--btn-grad-start), var(--btn-grad-mid), var(--btn-grad-end));
    color: var(--btn-text-color);
    font-weight: 600;
    border: none;
    cursor: pointer;
    box-shadow: 0 2px 10px var(--btn-primary-shadow);
    /* transition already set universally */
  }

  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px var(--btn-hover-shadow);
    background-image: linear-gradient(135deg, var(--btn-grad-start-hover), var(--btn-grad-start-hover), var(--btn-grad-end-hover));
  }
  
  .btn:active {
    transform: translateY(1px);
    box-shadow: 0 1px 5px var(--btn-primary-shadow);
  }
}


/* 5) Optional: honor system preference if no JS sets data-theme */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme]) body {
    /* این بخش حفظ شده اما پس‌زمینه گرادینت اولویت خواهد داشت */
    background-color: hsl(220, 40%, 15%);
  }
}

/* [خفن‌تر شد] 6) استایل اسکرول‌بار سفارشی */
::-webkit-scrollbar {
  width: 10px;
}

::-webkit-scrollbar-track {
  background: var(--background);
}

::-webkit-scrollbar-thumb {
  background-color: var(--accent-secondary);
  border-radius: 20px;
  border: 2px solid var(--background);
}

::-webkit-scrollbar-thumb:hover {
  background-color: var(--accent-primary);
}